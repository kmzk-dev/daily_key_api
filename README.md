# Daily Pass API

## デモ

このAPIを実際に試せるデモページを公開しています。

**[デモページへアクセスする](https://kmzk-dev.github.io/daily_key_api/)**

## 概要

`Daily Pass API` は、日替わりの認証キー（デイリーパスワード）を生成するシンプルなPHP製APIです。
安価なレンタルサーバーなど、手軽な環境で特別なライブラリなしに動作させることを目的としています。

データベースは不要で、サーバーの時刻と設定した秘密鍵を元に、毎日決まった文字列を生成します。

## 開発の背景

このAPIは、**勤怠管理システムの正式なアカウントを持たない臨時の従業員や、Slackのゲストアカウントで参加する協力会社のメンバー**が、使い慣れたSlack上で勤怠打刻できるようにするために開発されました。

アカウント発行の手間をかけることなく、日替わりの認証キーを用いることで、簡易的でありながらセキュアな本人確認を実現し、Slackのワークフローなどと連携してスムーズな勤怠管理の仕組みを構築することを目的としています。

## 特徴

* **日替わりパスワード**: 毎日同じパスワードを生成し、日付が変わると自動で新しいパスワードに切り替わります。
* **ユニークパスワード**: クエリパラメータ `extra` を使用することで、ユーザーや場所、用途ごとにユニークな日替わりパスワードを生成可能です。
* **カスタマイズ可能**: 生成する文字列の長さや種類（英数字/数字のみ）をリクエスト毎に指定できます。
* **軽量・シンプル**: PHPのみで動作し、データベースや外部ライブラリは不要です。
* **キャッシュ対応**: レスポンスヘッダーにより、生成されたパスワードは翌日の午前0時までクライアント側でキャッシュされるため、サーバーへの不要な負荷を軽減します。

## 主なユースケース

* **一時的な認証キーの発行**
    関係者だけに日替わりのパスワードを共有し、簡易的なアクセス制限を実現します。

* **勤怠管理システムでの位置情報証明の代替**
    オフィスに設置した固定端末からのみAPIをコールするルールを設ければ、「その場所から勤怠打刻が行われた」ことの証明として利用できます。

    ***【重要：運用上の注意】***
    この方法は、あくまで簡易的な位置証明の代替です。例えば、オフィスにいる従業員Aが、そこにいない従業員Bにパスワードを教えるといった「なりすまし」行為を、システムだけで完全に防ぐことは困難です。そのため、本APIを勤怠管理のような重要な用途で利用する際は、技術的な仕組みに頼るだけでなく、**不正行為に関する就業規則を設けるなど、明確な運用ルールと組み合わせて活用すること**を強く推奨します。

## 応用的なユースケースのアイデア

### 店舗やコミュニティでの活用

* **本日の割引コード**: 飲食店などで、APIが生成した「今日の数字」を伝えてもらうことで割引を適用します。
* **本日のWi-Fiパスワード**: コワーキングスペースなどで、定期的に変更したいWi-Fiパスワードとして利用します。

### Webサービスやシステムでの活用

* **ワンタイムダウンロードリンクの認証**: `extra` パラメータにファイルIDを指定することで、ファイルごとに日替わりの認証キーを発行し、セキュアなファイル共有を実現します。
* **簡易的なAPIリクエスト認証**: 本格的な認証が不要なAPIで、リクエスト元を簡易的に識別するための日替わりトークンとして利用します。

### ゲームやイベントでの活用

* **ビンゴゲームの採番**: `type=numeric` を利用して、毎日1つずつ新しい番号を抽選するビンゴマシンのように使えます。
* **日替わりクイズや懸賞のシード値**: APIが返す文字列を計算の元（シード値）にすることで、参加者全員が同じ問題に挑戦する日替わりクイズや、公平な抽選の基盤として利用します。

### その他

* **システム間のヘルスチェック**: 2つのシステムが同じ `SECRET_KEY` でAPIを叩き、同じ結果が返るかを確認することで、お互いの正常性を監視します。

## インストールと設定

### 要件

* PHPが動作するウェブサーバー

### 手順

1.  このリポジトリのファイル (`api/jst.php`など) をサーバーのお好みのディレクトリにアップロードします。
2.  `api/jst.php` から見て一つ上の階層に `private_config` という名前のディレクトリを作成します。
3.  `private_config` ディレクトリの中に `config.php` というファイル名で、以下の内容のファイルを作成します。

    ```php
    <?php
    // config.php

    // 32文字以上のランダムな文字列を強く推奨します
    define('SECRET_KEY', 'ここにあなただけの秘密の文字列を設定してください');
    ```
4.  `SECRET_KEY` には、第三者に推測されにくい、なるべく長くランダムな文字列を設定してください。

## API仕様

### エンドポイント

`https://(あなたのドメイン)/path/to/api/jst.php`

### メソッド

`GET`

### パラメータ

| パラメータ | 説明 | 型 | デフォルト値 | 指定可能な値 |
| :--- | :--- | :--- | :--- | :--- |
| `length` | (オプション) 生成する文字列の長さ。 | 整数 | `15` | `1` から `15` |
| `type` | (オプション) 生成する文字列の種類。 | 文字列 | `alphanumeric` | `alphanumeric`, `numeric` |
| `extra` | (オプション) パスワード生成に加える追加のシード値。 | 文字列 | (なし) | 任意の文字列 |

### 成功レスポンス (200 OK)

```json
{
    "random_string": "Abc123Def456Ghi",
    "generated_at_jst": "2025-06-17 14:30:00",
    "expires_at_jst": "2025-06-18 00:00:00",
    "length": 15
}
```

## 使用例 (curl)

**基本的なリクエスト**
```bash
curl "[https://example.com/api/jst.php](https://example.com/api/jst.php)"
```

**長さ8桁の数字をリクエスト**
```bash
curl "[https://example.com/api/jst.php?length=8&type=numeric](https://example.com/api/jst.php?length=8&type=numeric)"
```

**オフィスA専用のユニークなパスワードをリクエスト**
```bash
curl "[https://example.com/api/jst.php?extra=Office-A](https://example.com/api/jst.php?extra=Office-A)"
```

## セキュリティに関する注意

* **HTTPSの使用**: このAPIは必ず `https://` から始まるURLで利用してください。
* **SECRET\_KEYの管理**: `SECRET_KEY` はパスワード生成の根幹です。絶対に漏洩しないよう厳重に管理してください。
* **利用範囲**: このAPIは簡易的な認証を目的としています。高度なセキュリティが求められるシステムでの利用は推奨しません。

## ライセンス

このソフトウェアは、MITライセンスの元で公開されています。誰でも自由に利用、改変、再配布が可能です。

## リポジトリ構成

* `/api/jst.php`: Daily Pass APIの本体です。
* `/index.html`: APIを試すためのデモページのフロントエンドです。
* `/docker-compose.yml`: ローカルテスト環境を構築するためのDocker Composeファイルです。
* `/.gitignore`: Gitの追跡対象外のファイルを指定します。
* `/private_config/` (手動作成): `SECRET_KEY` を定義する `config.php` を設置するディレクトリです。